## GCP L7 
![image](https://github.com/youyoungnam/kubernetes-implement/assets/60678531/99779e91-0500-493f-a1a8-f3e9e5ae0ea7)
- 회사 내 서비스를 http에서 SSL 적용 후 https가 되었을 때 해당 서비스는 회사 말고 외부에서 접근을 못하게 막아야 했었다. SSL적용 후 GCP 내 방화벽에서 회사 아이피 대역대만 열어주고 나머지 다 막았으나 알고보니 외부에서 쉽게 접근이 가능했다. 
- 솔직히 처음에는 어떤 부분이 잘못된지 몰랐다. 분명히 우리는 방화벽에서 사내 아이피만 열어줬는데 외부에서 쉽게 접근이 가능했다는게 이해가 되지않았다. 
- 알고보니까 GCP L7 적용하게 되면, 해당 방화벽은 GCP armor 서비스를 이용해야 했다. gcp에 기존 존재하는 방화벽 설정으로는 적용되지 않았던 것이였다. 

## GCP Armor 설정 후 
- L7 방화벽 설정 이후 외부에서 접근은 막았으나, 문제는 그 이후부터다. 사내 서비스 로그인을 했는데 500 error가 나오는 것이였다.(자세하게 설명못하는 점 이해 부탁드립니다.) 사내에서만 접속은 가능하지만, 로그인을 했을 때 500 error가 반응을 했을 때 이해가 되지않았는데 하나씩 생각해봤다.
- 첫 번째 L7의 대역대를 열어줘야하나? 생각했었다. 그래서 방화벽에 L7의 대역대를 열어줬으나 잘못된 생각이였다. 여전히 같은 500 error가 나왔다. 
- 두 번째는 성공이였다. 우리는 oauth2-proxy를 사용중인데, oauth2-proxy 설정에서 아마도 cluster 외부로 나갔다가 다시 들어오는 거같은 기분이 들었었다. 즉, oauth2-proxy에서 클러스터 나트 게이트웨이를 타고 다시 들어오는 기분이 들어서 나트 게이트웨이 대역대를 열어주니 성공한 것이였다. 

